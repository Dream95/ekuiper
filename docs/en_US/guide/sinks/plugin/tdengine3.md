# TDengine3 Sink

## Compile the plugins

In eKuiper source code root path, run the below commandï¼š

```shell
go build -trimpath --buildmode=plugin -o plugins/sinks/Tdengine3.so extensions/sinks/tdengine3/*.go
```

## Rule Actions Description

As the tdengine database requires a timestamp field in the table, the user must inform the timestamp field name of the data table (required tsFieldName). The user can choose whether to provide timestamp data. If not (provideTs=false), the content of the timestamp field is automatically generated by the tdengine database.

| Name        | Type     | Optional | Description                                                                                                                                                   |
|-------------|----------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|
| host        | string   | false    | Database host name, default to localhost. The default value is localhost.                                                                                     |
| port        | int      | false    | Database port , default to 6041.                                                                                                                              |
| user        | string   | false    | Username, default to root.                                                                                                                                    |
| password    | string   | false    | Password, default to taosdata.                                                                                                                                |
| database    | string   | true     | Database name.                                                                                                                                                |
| table       | string   | true     | Table Name, could be a [dynamic property](../overview.md#dynamic-properties).                                                                                 |
| fields      | []string | false    | The fields to be inserted to. The result map and the database should both have these fields. If not specified, all fields in the result map will be inserted. |
| provideTs   | Bool     | false    | Whether the user provides a timestamp field, default to false.                                                                                                |
| tsFieldName | String   | true     | Timestamp field name                                                                                                                                          |
| sTable      | String   | false    | The super table to be use, could be a [dynamic property](../overview.md#dynamic-properties).                                                                  |
| tagFields   | []String | false    | The result fields to be used as the tag values in order. If sTable is specified, this is required.                                                            |

Other common sink properties are supported. Please refer to the sink common properties for more information.

## Operation example

### To create a database or table, refer to the following documents

```http
https://docs.taosdata.com/get-started/
```

### Create a stream

```bash
curl --location --request POST 'http://127.0.0.1:9081/streams' --header 'Content-Type:application/json' --data '{"sql":"create stream demoStream(time string, age BIGINT) WITH ( DATASOURCE = \"device/+/message\", FORMAT = \"json\");"}'
```

### Create a rule

```bash
curl --location --request POST 'http://127.0.0.1:9081/rules' --header 'Content-Type:application/json' --data '{"id":"demoRule","sql":"SELECT * FROM demoStream;","actions":[{"tdengine3":{"provideTs":true,"tsFieldName":"time","user":"root","password":"taosdata","database":"dbName","table":"tableName","fields":["time","age"]}}]}'
```

Write into fixed table:

```json
{
  "tdengine3": {
    "host":        "127.0.0.1",
    "port":        6041,
    "user":        "root",
    "password":    "taosdata",
    "database":    "db",
    "table":       "table1",
    "tsfieldname": "ts"
  }
}
```

Write into dynamic table:

```json
{
  "tdengine3": {
    "sendSingle":   true,
    "host":        "hostname",
    "port":        6041,
    "user":        "root",
    "password":    "taosdata",
    "database":    "db",
    "table":       "{{.tName}}",
    "tsfieldname": "ts"
  }
}
```
